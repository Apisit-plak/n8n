# ЁЯФз р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Sales Performance (р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕Вр╕нр╕Зр╣Ар╕Лр╕ер╕кр╣М)

## ЁЯУЛ р╕ар╕▓р╕Юр╕гр╕зр╕б

Feature р╕Щр╕╡р╣Йр╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Др╕│р╕Цр╕▓р╕бр╣Бр╕Ър╕Ъ: **"TOP 10 р╣Ар╕Лр╕ер╕кр╣Мр╕вр╕нр╕Фр╣Ар╕вр╕нр╕░р╕кр╕╕р╕Ф"**, **"р╣Ар╕Лр╕ер╕кр╣М р╕кр╕бр╕Кр╕▓р╕в р╕бр╕╡ invoice р╣Ар╕Чр╣Ир╕▓р╣Др╕лр╕гр╣И"**

р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Бр╕кр╕Фр╕З:
- р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╣Ар╕Лр╕ер╕кр╣Мр╕Юр╕гр╣Йр╕нр╕бр╕вр╕нр╕Фр╕Вр╕▓р╕в
- р╕Ир╕│р╕Щр╕зр╕Щ Invoice, р╕ер╕╣р╕Бр╕Др╣Йр╕▓, р╕кр╕┤р╕Щр╕Др╣Йр╕▓
- р╕вр╕нр╕Фр╣Ар╕Йр╕ер╕╡р╣Ир╕в, р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓
- р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕ер╕╣р╕Бр╕Др╣Йр╕▓

---

## ЁЯОп р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Др╕│р╕Цр╕▓р╕бр╕Чр╕╡р╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ъ:

### 1. р╕Фр╕╣ TOP р╣Ар╕Лр╕ер╕кр╣М:
```
тЬЕ TOP 10 р╣Ар╕Лр╕ер╕кр╣Мр╕вр╕нр╕Фр╣Ар╕вр╕нр╕░р╕кр╕╕р╕Ф
тЬЕ TOP 5 р╣Ар╕Лр╕ер╕кр╣Мр╕Ыр╕╡р╕Щр╕╡р╣Й
тЬЕ р╣Ар╕Лр╕ер╕кр╣Мр╣Др╕лр╕Щр╕Вр╕▓р╕вр╕Фр╕╡р╕Чр╕╡р╣Ир╕кр╕╕р╕Ф 6 р╣Ар╕Фр╕╖р╕нр╕Щ
тЬЕ TOP 10 р╣Ар╕Лр╕ер╕кр╣М 1 р╕Ыр╕╡
```

### 2. р╕Др╣Йр╕Щр╕лр╕▓р╣Ар╕Лр╕ер╕кр╣Мр╕Др╕Щр╣Гр╕Фр╕Др╕Щр╕лр╕Щр╕╢р╣Ир╕З:
```
тЬЕ р╣Ар╕Лр╕ер╕кр╣М р╕кр╕бр╕Кр╕▓р╕в р╕бр╕╡ invoice р╣Ар╕Чр╣Ир╕▓р╣Др╕лр╕гр╣И
тЬЕ р╣Ар╕Лр╕ер╕кр╣М р╕кр╕бр╕ир╕▒р╕Бр╕Фр╕┤р╣М р╕Вр╕▓р╕вр╣Др╕Фр╣Йр╣Ар╕Чр╣Ир╕▓р╣Др╕лр╕гр╣Ир╕Ыр╕╡р╕Щр╕╡р╣Й
тЬЕ р╣Ар╕Лр╕ер╕кр╣М р╕зр╕▒р╕Щр╕Кр╕▒р╕в р╕вр╕нр╕Фр╕Вр╕▓р╕в 6 р╣Ар╕Фр╕╖р╕нр╕Щ
```

### 3. р╕Фр╕╣р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф:
```
тЬЕ р╣Ар╕Лр╕ер╕кр╣Мр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Вр╕▓р╕вр╣Др╕Фр╣Йр╣Ар╕Чр╣Ир╕▓р╣Др╕лр╕гр╣И
тЬЕ TOP 100 р╣Ар╕Лр╕ер╕кр╣М
```

---

## тЪЩя╕П р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╣Гр╕Щ n8n

### 1я╕ПтГг р╕нр╕▒р╕Юр╣Ар╕Фр╕Ч Parser (Code Node)

**р╣Др╕Яр╕ер╣М:** `n8n_code_parser.js`

тЬЕ **р╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з!** Parser р╣Др╕Фр╣Йр╕Цр╕╣р╕Бр╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╣Бр╕ер╣Йр╕зр╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕нр╕Зр╕гр╕▒р╕Ъ `sales_performance` action

**р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣И Parser р╕Ир╕░р╕Чр╕│:**
- р╕Ир╕▒р╕Ър╕Др╕│р╕Цр╕▓р╕бр╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Бр╕▒р╕Ър╣Ар╕Лр╕ер╕кр╣М
- Extract р╕Кр╕╖р╣Ир╕нр╣Ар╕Лр╕ер╕кр╣М (р╕Цр╣Йр╕▓р╕бр╕╡)
- Extract limit (р╣Ар╕Кр╣Ир╕Щ TOP 5, 10 р╕Др╕Щ) - default: 10
- Extract time period (р╕Цр╣Йр╕▓р╕бр╕╡)
- Return: `{ action: 'sales_performance', sales_person_name: '...', limit: 10, time_period: {...} }`

---

### 2я╕ПтГг р╣Ар╕Юр╕┤р╣Ир╕б Route р╣Гр╕Щ Switch Node

1. р╣Ар╕Ыр╕┤р╕Ф **Switch** node р╣Гр╕Щ n8n workflow
2. р╕Др╕ер╕┤р╕Б **Add Routing Rule**
3. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ route р╣Гр╕лр╕бр╣И:

```
Output: 8 (р╕лр╕гр╕╖р╕нр╕лр╕бр╕▓р╕вр╣Ар╕ер╕Вр╕Цр╕▒р╕Фр╣Др╕Ы)
Mode: Rules
Rules:
  - Field: action
  - Condition: is equal to
  - Value: sales_performance
```

4. р╕Др╕ер╕┤р╕Б **Save**

---

### 3я╕ПтГг р╣Ар╕Юр╕┤р╣Ир╕б Execute SQL Node

1. р╣Ар╕Юр╕┤р╣Ир╕б **MySQL** node (Execute SQL)
2. р╣Ар╕Кр╕╖р╣Ир╕нр╕б output 8 р╕Ир╕▓р╕Б Switch node р╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ъ MySQL node р╕Щр╕╡р╣Й
3. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓:
   - **Credential:** `Datawarehouse_test`
   - **Operation:** `Execute Query`
   - **Query:** р╕Др╕▒р╕Фр╕ер╕нр╕Бр╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М `SQL_SALES_PERFORMANCE.md`

**SQL Query** (р╕Др╕▒р╕Фр╕ер╕нр╕Бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф):

```sql
SELECT
    h.inv_sales_person AS sales_person_code,
    h.inv_sales_person_name AS sales_person_name,
    COUNT(DISTINCT h.inv_no) AS invoice_count,
    COUNT(DISTINCT h.inv_customer_no) AS customer_count,
    COUNT(DISTINCT l.inv_line_item_no) AS product_count,
    SUM(l.inv_line_amount) AS total_amount,
    SUM(l.inv_line_amount_vat) AS total_vat,
    SUM(l.inv_line_amount + l.inv_line_amount_vat) AS net_amount,
    SUM(l.inv_line_quantity) AS total_quantity,
    AVG(l.inv_line_amount + l.inv_line_amount_vat) AS avg_invoice_amount,
    MIN(h.inv_posting_date) AS first_invoice_date,
    MAX(h.inv_posting_date) AS last_invoice_date,
    GROUP_CONCAT(DISTINCT h.inv_customer_name ORDER BY h.inv_customer_name SEPARATOR ', ' LIMIT 5) AS top_customers,
    GROUP_CONCAT(DISTINCT h.inv_department_name ORDER BY h.inv_department_name SEPARATOR ', ') AS departments
FROM data_warehouse.service_posted_invoice_header h
LEFT JOIN data_warehouse.service_posted_invoice_line l
    ON h.inv_no = l.inv_line_inv_no
WHERE 1=1
{{ $json.sales_person_name ? `
    AND (h.inv_sales_person_name LIKE '%${$json.sales_person_name}%' 
         OR h.inv_sales_person LIKE '%${$json.sales_person_name}%')
` : '' }}
{{ $json.time_period && $json.time_period.period === 'this_year' ? `
    AND YEAR(h.inv_posting_date) = YEAR(CURDATE())
` : '' }}
{{ $json.time_period && $json.time_period.period === 'last_year' ? `
    AND YEAR(h.inv_posting_date) = YEAR(CURDATE()) - 1
` : '' }}
{{ $json.time_period && $json.time_period.period === 'this_month' ? `
    AND YEAR(h.inv_posting_date) = YEAR(CURDATE())
    AND MONTH(h.inv_posting_date) = MONTH(CURDATE())
` : '' }}
{{ $json.time_period && $json.time_period.period === 'last_month' ? `
    AND YEAR(h.inv_posting_date) = YEAR(CURDATE())
    AND MONTH(h.inv_posting_date) = MONTH(CURDATE()) - 1
` : '' }}
{{ $json.time_period && $json.time_period.period === 'month' && $json.time_period.value ? `
    AND h.inv_posting_date >= DATE_SUB(CURDATE(), INTERVAL ${$json.time_period.value} MONTH)
` : '' }}
{{ $json.time_period && $json.time_period.period === 'year' && $json.time_period.value ? `
    AND h.inv_posting_date >= DATE_SUB(CURDATE(), INTERVAL ${$json.time_period.value} YEAR)
` : '' }}
    AND h.inv_sales_person IS NOT NULL
    AND h.inv_sales_person != ''
GROUP BY
    h.inv_sales_person,
    h.inv_sales_person_name
HAVING COUNT(DISTINCT h.inv_no) > 0
ORDER BY net_amount DESC
LIMIT {{ $json.limit || 10 }}
```

4. р╣Др╕Ыр╕Чр╕╡р╣И **Settings** tab
5. р╣Ар╕Ыр╕┤р╕Ф **Continue on Fail** р╣Бр╕ер╕░ **Always Output Data**
6. р╕Др╕ер╕┤р╕Б **Save**

---

### 4я╕ПтГг р╣Ар╕Юр╕┤р╣Ир╕б Formatter (Code Node)

1. р╣Ар╕Юр╕┤р╣Ир╕б **Code** node р╕лр╕ер╕▒р╕З MySQL node
2. р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Кр╕╖р╣Ир╕нр╣Ар╕Ыр╣Зр╕Щ `Format_SalesPerformance`
3. р╕Др╕▒р╕Фр╕ер╕нр╕Бр╣Вр╕Др╣Йр╕Фр╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М `FORMATTER_SALES_PERFORMANCE.js` р╕зр╕▓р╕Зр╣Гр╕Щ Code editor
4. р╕Др╕ер╕┤р╕Б **Save**

---

### 5я╕ПтГг р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ Respond to Webhook

1. р╣Ар╕Кр╕╖р╣Ир╕нр╕б output р╕Ир╕▓р╕Б `Format_SalesPerformance` node р╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ъ **Respond to Webhook** node
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Respond to Webhook р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕Ыр╣Зр╕Щ:
   - **Respond With:** `Using Fields Below`
   - **Response Body:** `{{ $json.reply }}`
   - **Response Code:** `200`

---

## ЁЯзк р╕Чр╕Фр╕кр╕нр╕Ъ Workflow

### р╕зр╕┤р╕Шр╕╡р╕Чр╕Фр╕кр╕нр╕Ъ:

1. р╕Др╕ер╕┤р╕Б **Execute Workflow** р╣Гр╕Щ n8n
2. р╕кр╣Ир╕Зр╕Др╕│р╕Цр╕▓р╕бр╕Ир╕▓р╕Б chat interface:

```bash
TOP 10 р╣Ар╕Лр╕ер╕кр╣Мр╕вр╕нр╕Фр╣Ар╕вр╕нр╕░р╕кр╕╕р╕Ф
```

### р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З:

```
ЁЯСе р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕Вр╕нр╕Зр╣Ар╕Лр╕ер╕кр╣М

1. **р╕кр╕бр╕Кр╕▓р╕в р╕зр╕▒р╕Тр╕Щр╕▓** (S001)
   ЁЯТ░ р╕вр╕нр╕Фр╕гр╕зр╕б: 5,000,000.00 р╕Ър╕▓р╕Ч (35.0%)
   ЁЯУД Invoice: 150 р╣Гр╕Ъ | ЁЯСе р╕ер╕╣р╕Бр╕Др╣Йр╕▓: 25 р╕гр╕▓р╕в
   ЁЯУж р╕кр╕┤р╕Щр╕Др╣Йр╕▓: 80 р╕гр╕▓р╕вр╕Бр╕▓р╕г | ЁЯУК р╣Ар╕Йр╕ер╕╡р╣Ир╕в: 33,333.33 р╕Ър╕▓р╕Ч/р╣Гр╕Ъ
   ЁЯУЕ р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓: 2025-01-01 р╕Цр╕╢р╕З 2026-01-20
   ЁЯСе р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕ер╕╣р╕Бр╕Др╣Йр╕▓: р╕Бр╕▓р╕гр╣Мр╣Ар╕Фр╕╡р╕вр╕Щр╕нр╕┤р╕Щр╕Фр╕▒р╕кр╕Чр╕гр╕╡р╕кр╣М, р╕Ър╕гр╕┤р╕йр╕▒р╕Ч ABC, ...

2. **р╕кр╕бр╕ир╕▒р╕Бр╕Фр╕┤р╣М р╣Гр╕Ир╕Фр╕╡** (S002)
   ЁЯТ░ р╕вр╕нр╕Фр╕гр╕зр╕б: 4,500,000.00 р╕Ър╕▓р╕Ч (31.5%)
   ...

тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ

ЁЯУК р╕кр╕гр╕╕р╕Ыр╕гр╕зр╕б:
   ЁЯСе р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Лр╕ер╕кр╣М: 10 р╕Др╕Щ
   ЁЯТ░ р╕вр╕нр╕Фр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф: 14,285,714.29 р╕Ър╕▓р╕Ч
   ЁЯУД Invoice р╕гр╕зр╕б: 850 р╣Гр╕Ъ
   ЁЯСе р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕гр╕зр╕б: 250 р╕гр╕▓р╕в

тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ
ЁЯТб р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б?
  тАв "р╣Ар╕Лр╕ер╕кр╣М р╕кр╕бр╕Кр╕▓р╕в р╕зр╕▒р╕Тр╕Щр╕▓ р╕Вр╕▓р╕вр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕нр╕░р╣Др╕гр╕Ър╣Йр╕▓р╕З" - р╕Фр╕╣р╕кр╕┤р╕Щр╕Др╣Йр╕▓
  тАв "TOP 10 р╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Вр╕▓р╕вр╕Фр╕╡р╕Чр╕╡р╣Ир╕кр╕╕р╕Ф" - р╕Фр╕╣р╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Вр╕▓р╕вр╕Фр╕╡
  тАв "р╕ир╕╣р╕Щр╕вр╣Мр╣Др╕лр╕Щр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Ар╕вр╕нр╕░р╕кр╕╕р╕Ф" - р╕Фр╕╣р╕ир╕╣р╕Щр╕вр╣Мр╕Чр╕╡р╣Ир╕Вр╕▓р╕вр╕Фр╕╡
```

---

## тЪая╕П р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕кр╕│р╕Др╕▒р╕Н:

### 1. Sales Person from Header
- р╣Гр╕Кр╣Й `inv_sales_person_name` р╣Бр╕ер╕░ `inv_sales_person` р╕Ир╕▓р╕Б **header table**
- р╣Др╕бр╣Ир╣Гр╕Кр╣И `inv_line_sales_person` р╕Ир╕▓р╕Б line table

### 2. Name Filter
- р╕Бр╕гр╕нр╕Зр╕Фр╣Йр╕зр╕в LIKE '%...%' р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╣Йр╕Щр╕лр╕▓р╕Ър╕▓р╕Зр╕кр╣Ир╕зр╕Щ
- р╕Др╣Йр╕Щр╕лр╕▓р╕Чр╕▒р╣Йр╕З `inv_sales_person_name` р╣Бр╕ер╕░ `inv_sales_person`

### 3. Time Period Support
- р╕гр╕нр╕Зр╕гр╕▒р╕Ъ: this_year, last_year, 6 р╣Ар╕Фр╕╖р╕нр╕Щ, 1 р╕Ыр╕╡, etc.
- р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕р╕Ир╕░р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф

### 4. Limit Support
- **Default:** 10 р╕Др╕Щ
- **р╕гр╕нр╕Зр╕гр╕▒р╕Ъ:**
  - `TOP 5` тЖТ 5 р╕Др╕Щ
  - `10 р╕Др╕Щ` тЖТ 10 р╕Др╕Щ
  - `р╣Бр╕кр╕Фр╕З 20` тЖТ 20 р╕Др╕Щ
  - `р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф` тЖТ 100 р╕Др╕Щ

### 5. No Data Handling
- р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е formatter р╕Ир╕░р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Лр╕ер╕кр╣М"
- р╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╕┤р╕Ф **Continue on Fail** р╣Бр╕ер╕░ **Always Output Data** р╣Гр╕Щ Execute SQL node

---

## ЁЯУК р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕З:

1. **р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Лр╕ер╕кр╣Мр╣Бр╕Хр╣Ир╕ер╕░р╕Др╕Щ:**
   - р╕Кр╕╖р╣Ир╕нр╣Ар╕Лр╕ер╕кр╣М + р╕гр╕лр╕▒р╕к
   - р╕вр╕нр╕Фр╕гр╕зр╕бр╕кр╕╕р╕Чр╕Шр╕┤ + %
   - р╕Ир╕│р╕Щр╕зр╕Щ Invoice
   - р╕Ир╕│р╕Щр╕зр╕Щр╕ер╕╣р╕Бр╕Др╣Йр╕▓
   - р╕Ир╕│р╕Щр╕зр╕Щр╕кр╕┤р╕Щр╕Др╣Йр╕▓
   - р╕вр╕нр╕Фр╣Ар╕Йр╕ер╕╡р╣Ир╕вр╕Хр╣Ир╕н Invoice
   - р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓ (р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕гр╕Бр╣Бр╕ер╕░р╕ер╣Ир╕▓р╕кр╕╕р╕Ф)
   - р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕ер╕╣р╕Бр╕Др╣Йр╕▓ (р╕нр╕▒р╕Щр╕Фр╕▒р╕Ъ 1-3)

2. **р╕кр╕гр╕╕р╕Ыр╕гр╕зр╕б:**
   - р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Лр╕ер╕кр╣Мр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
   - р╕вр╕нр╕Фр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
   - Invoice р╕гр╕зр╕б
   - р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕гр╕зр╕б

3. **Contextual Suggestions:**
   - р╕Др╕│р╕Цр╕▓р╕бр╣Бр╕Щр╕░р╕Щр╕│р╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕З

---

## ЁЯФз Troubleshooting:

### р╕Ыр╕▒р╕Нр╕лр╕▓: р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕кр╕Фр╕Зр╕нр╕нр╕Бр╕бр╕▓
**р╣Бр╕Бр╣Йр╣Др╕В:**
1. р╣Ар╕Кр╣Зр╕Д Execute SQL node тЖТ Settings тЖТ р╣Ар╕Ыр╕┤р╕Ф **Continue on Fail** р╣Бр╕ер╕░ **Always Output Data**
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Кр╕╖р╣Ир╕нр╣Ар╕Лр╕ер╕кр╣Мр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
3. р╕ер╕нр╕Зр╕Цр╕▓р╕бр╣Бр╕Ър╕Ъ "TOP 10 р╣Ар╕Лр╕ер╕кр╣М" р╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╣Ар╕Лр╕ер╕кр╣Мр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф

### р╕Ыр╕▒р╕Нр╕лр╕▓: Parser р╕Ир╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щ action р╕нр╕╖р╣Ир╕Щ
**р╣Бр╕Бр╣Йр╣Др╕В:**
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕│р╕Цр╕▓р╕бр╕зр╣Ир╕▓р╕бр╕╡р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И (р╕Хр╣Йр╕нр╕Зр╕бр╕╡ "р╣Ар╕Лр╕ер╕кр╣М" р╕лр╕гр╕╖р╕н "sales")
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ `n8n_code_parser.js` р╣Др╕Фр╣Йр╕Цр╕╣р╕Бр╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
3. р╕Фр╕╣ console.log р╣Гр╕Щ parser node р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ

### р╕Ыр╕▒р╕Нр╕лр╕▓: р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
**р╣Бр╕Бр╣Йр╣Др╕В:**
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ SQL query р╕зр╣Ир╕▓ WHERE conditions р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ time period р╕Цр╕╣р╕Б extract р╕бр╕▓р╕нр╕вр╣Ир╕▓р╕Зр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
3. р╕Чр╕Фр╕кр╕нр╕Ъ SQL query р╣Вр╕Фр╕вр╕Хр╕гр╕Зр╣Гр╕Щ database

---

## ЁЯУЪ р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕З:

1. **Parser:** `n8n_code_parser.js` (lines 676-765)
2. **SQL Query:** `SQL_SALES_PERFORMANCE.md`
3. **Formatter:** `FORMATTER_SALES_PERFORMANCE.js`
4. **Test Questions:** `TEST_QUESTIONS.md` (section 7)
5. **Setup Guide:** `SALES_PERFORMANCE_SETUP_GUIDE.md` (р╣Др╕Яр╕ер╣Мр╕Щр╕╡р╣Й)

---

## тЬЕ Checklist р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З:

- [ ] р╕нр╕▒р╕Юр╣Ар╕Фр╕Ч parser (`n8n_code_parser.js`)
- [ ] р╣Ар╕Юр╕┤р╣Ир╕б route р╣Гр╕Щ Switch node (output 8: `sales_performance`)
- [ ] р╣Ар╕Юр╕┤р╣Ир╕б Execute SQL node р╕Юр╕гр╣Йр╕нр╕б SQL query
- [ ] р╣Ар╕Ыр╕┤р╕Ф **Continue on Fail** р╣Бр╕ер╕░ **Always Output Data** р╣Гр╕Щ Execute SQL node
- [ ] р╣Ар╕Юр╕┤р╣Ир╕б Code node (formatter) р╕Юр╕гр╣Йр╕нр╕бр╣Вр╕Др╣Йр╕Фр╕Ир╕▓р╕Б `FORMATTER_SALES_PERFORMANCE.js`
- [ ] р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ Respond to Webhook node
- [ ] р╕Чр╕Фр╕кр╕нр╕Ър╕Фр╣Йр╕зр╕вр╕Др╕│р╕Цр╕▓р╕б "TOP 10 р╣Ар╕Лр╕ер╕кр╣Мр╕вр╕нр╕Фр╣Ар╕вр╕нр╕░р╕кр╕╕р╕Ф"
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕гр╕Ур╕╡р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е (no data)
- [ ] р╕Чр╕Фр╕кр╕нр╕Ър╕Фр╣Йр╕зр╕в time period (р╣Ар╕Кр╣Ир╕Щ "6 р╣Ар╕Фр╕╖р╕нр╕Щ", "р╕Ыр╕╡р╕Щр╕╡р╣Й")
- [ ] р╕Чр╕Фр╕кр╕нр╕Ър╕Др╣Йр╕Щр╕лр╕▓р╣Ар╕Лр╕ер╕кр╣Мр╕Др╕Щр╣Гр╕Фр╕Др╕Щр╕лр╕Щр╕╢р╣Ир╕З

---

## ЁЯОЙ р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ!

р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕гр╕░р╕Ър╕Ър╕Юр╕гр╣Йр╕нр╕бр╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Др╕│р╕Цр╕▓р╕б **"TOP 10 р╣Ар╕Лр╕ер╕кр╣Мр╕вр╕нр╕Фр╣Ар╕вр╕нр╕░р╕кр╕╕р╕Ф"** р╣Бр╕ер╣Йр╕з!

р╕ер╕нр╕Зр╕Цр╕▓р╕бр╕Др╕│р╕Цр╕▓р╕бр╕Хр╣Ир╕▓р╕Зр╣Ж р╣Ар╕Юр╕╖р╣Ир╕нр╕Чр╕Фр╕кр╕нр╕Ъ:
- `TOP 10 р╣Ар╕Лр╕ер╕кр╣Мр╕вр╕нр╕Фр╣Ар╕вр╕нр╕░р╕кр╕╕р╕Ф`
- `TOP 5 р╣Ар╕Лр╕ер╕кр╣Мр╕Ыр╕╡р╕Щр╕╡р╣Й`
- `р╣Ар╕Лр╕ер╕кр╣М [р╕Кр╕╖р╣Ир╕н] р╕бр╕╡ invoice р╣Ар╕Чр╣Ир╕▓р╣Др╕лр╕гр╣И`
- `р╣Ар╕Лр╕ер╕кр╣Мр╣Др╕лр╕Щр╕Вр╕▓р╕вр╕Фр╕╡р╕Чр╕╡р╣Ир╕кр╕╕р╕Ф 6 р╣Ар╕Фр╕╖р╕нр╕Щ`
