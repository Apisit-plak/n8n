# üîç Top Items with Filter - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£**‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠**‡πÅ‡∏•‡πâ‡∏ß!

‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤: **"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CMP-Air Compressor ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô"**

‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞:
1. ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ "CMP-Air Compressor" ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠
2. ‡πÅ‡∏™‡∏î‡∏á TOP 3 ‡∏ï‡∏±‡∏ß (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤ "**‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô**")
3. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢

---

## üéØ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:

### 1. ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:
```
‚úÖ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CMP-Air Compressor ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô
   ‚Üí ‡∏Å‡∏£‡∏≠‡∏á "CMP-Air Compressor" + ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏ï‡∏±‡∏ß

‚úÖ TOP 5 ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ULTRA COOLANT
   ‚Üí ‡∏Å‡∏£‡∏≠‡∏á "ULTRA COOLANT" + ‡πÅ‡∏™‡∏î‡∏á 5 ‡∏ï‡∏±‡∏ß

‚úÖ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ LAST PAYMENT ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
   ‚Üí ‡∏Å‡∏£‡∏≠‡∏á "LAST PAYMENT" + ‡πÅ‡∏™‡∏î‡∏á 10 ‡∏ï‡∏±‡∏ß
```

### 2. ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏á (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤):
```
‚úÖ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
   ‚Üí ‡πÅ‡∏™‡∏î‡∏á TOP 10 ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

‚úÖ TOP 20 ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
   ‚Üí ‡πÅ‡∏™‡∏î‡∏á TOP 20 ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏ä‡πà‡∏ß‡∏á 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
```

### 3. ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ + ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:
```
‚úÖ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CMP-Air Compressor ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
   ‚Üí ‡∏Å‡∏£‡∏≠‡∏á "CMP-Air Compressor" + ‡∏ä‡πà‡∏ß‡∏á 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô + ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏ï‡∏±‡∏ß

‚úÖ TOP 10 ULTRA COOLANT ‡∏õ‡∏µ‡∏ô‡∏µ‡πâ
   ‚Üí ‡∏Å‡∏£‡∏≠‡∏á "ULTRA COOLANT" + ‡∏õ‡∏µ‡∏ô‡∏µ‡πâ + ‡πÅ‡∏™‡∏î‡∏á 10 ‡∏ï‡∏±‡∏ß
```

---

## üîß ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö:

### 1. Parser (`n8n_code_parser.js`)

**Input:**
```
"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CMP-Air Compressor ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô"
```

**Output:**
```json
{
  "action": "top_items",
  "item_filter": "CMP-Air Compressor",
  "limit": 3,
  "time_period": null
}
```

**‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
- ‡∏•‡∏ö keyword ‡∏≠‡∏≠‡∏Å: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", "‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", "‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô"
- ‡πÄ‡∏´‡∏•‡∏∑‡∏≠: "CMP-Air Compressor" ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô filter
- ‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤ "**‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô**" ‚Üí limit = 3 (‡πÅ‡∏ó‡∏ô 10)

---

### 2. WHERE Builder (`SQL_WHERE_BUILDER.js`)

**Input:**
```json
{
  "action": "top_items",
  "item_filter": "CMP-Air Compressor",
  "limit": 3
}
```

**Output:**
```json
{
  "where_clause": "WHERE 1=1 AND (l.inv_line_description LIKE '%CMP-Air Compressor%' OR l.inv_line_item_no LIKE '%CMP-Air Compressor%')"
}
```

**‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á WHERE clause ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á `inv_line_description` ‡∏´‡∏£‡∏∑‡∏≠ `inv_line_item_no`
- ‡πÉ‡∏ä‡πâ LIKE '%...%' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô

---

### 3. SQL Query

```sql
SELECT
  l.inv_line_item_no AS item_no,
  l.inv_line_description AS item_description,
  SUM(l.inv_line_amount) AS total_amount,
  ...
FROM data_warehouse.service_posted_invoice_line l
LEFT JOIN data_warehouse.service_posted_invoice_header h
  ON h.inv_no = l.inv_line_inv_no
WHERE 1=1 
  AND (l.inv_line_description LIKE '%CMP-Air Compressor%' 
       OR l.inv_line_item_no LIKE '%CMP-Air Compressor%')
  AND l.inv_line_item_no IS NOT NULL
  AND l.inv_line_item_no != ''
GROUP BY 
  l.inv_line_item_no,
  l.inv_line_description
ORDER BY total_amount DESC
LIMIT 3
```

---

## üìä Default Limit ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:

| ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° | Limit |
|--------|-------|
| "**‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô**" / "**‡∏≠‡∏±‡∏ô‡πÑ‡∏´‡∏ô**" | 3 ‡∏ï‡∏±‡∏ß |
| "TOP 5" | 5 ‡∏ï‡∏±‡∏ß |
| "10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" | 10 ‡∏ï‡∏±‡∏ß |
| "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" | 100 ‡∏ï‡∏±‡∏ß |
| *(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)* | 10 ‡∏ï‡∏±‡∏ß (default) |

---

## ‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:

1. **`n8n_code_parser.js`** ‚úÖ
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° item_filter extraction
   - ‡∏õ‡∏£‡∏±‡∏ö default limit ‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤ "‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô"

2. **`SQL_WHERE_BUILDER.js`** ‚úÖ
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° item_filter_condition
   - ‡∏Å‡∏£‡∏≠‡∏á `inv_line_description` ‡πÅ‡∏•‡∏∞ `inv_line_item_no`

3. **SQL Query** (‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ä‡πâ `{{ $json.where_clause }}` ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß

---

## üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠
```
‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CMP-Air Compressor ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô
```
**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:**
- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ "CMP-Air Compressor" ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠
- ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏ï‡∏±‡∏ß
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢

---

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏£‡∏≠‡∏á + ‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
```
TOP 5 ULTRA COOLANT 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
```
**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:**
- ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ "ULTRA COOLANT"
- ‡∏ä‡πà‡∏ß‡∏á 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
- ‡πÅ‡∏™‡∏î‡∏á 5 ‡∏ï‡∏±‡∏ß

---

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà 3: ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏á
```
‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
```
**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:**
- ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏á (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)
- ‡∏ä‡πà‡∏ß‡∏á 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
- ‡πÅ‡∏™‡∏î‡∏á 10 ‡∏ï‡∏±‡∏ß

---

## üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:

### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Parser Output:
‡∏î‡∏π‡∏ó‡∏µ‡πà output ‡∏Ç‡∏≠‡∏á Code node (Parser):
```json
{
  "action": "top_items",
  "item_filter": "CMP-Air Compressor",  // ‚Üê ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
  "limit": 3,
  "time_period": null
}
```

### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö WHERE Clause:
‡∏î‡∏π‡∏ó‡∏µ‡πà output ‡∏Ç‡∏≠‡∏á WHERE Builder node:
```json
{
  "where_clause": "WHERE 1=1 AND (l.inv_line_description LIKE '%CMP-Air Compressor%' ...)"
}
```

---

## üí° Tips:

1. **‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏£‡∏ö:**
   - "CMP-Air" ‚Üí ‡∏à‡∏∞‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ "CMP-Air" ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠
   - "COOLANT" ‚Üí ‡∏à‡∏∞‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ "COOLANT" ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠

2. **Case Insensitive:**
   - "cmp-air compressor" = "CMP-Air Compressor" = "CMP-AIR COMPRESSOR"

3. **‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤ "‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô" ‚Üí ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏ï‡∏±‡∏ß:**
   - ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô: "TOP 10", "20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ:

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:
- ‚úÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠
- ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö limit ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
- ‚úÖ ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö time period ‡πÑ‡∏î‡πâ

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
```
‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CMP-Air Compressor ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
‚Üí ‡∏Å‡∏£‡∏≠‡∏á "CMP-Air Compressor" + ‡∏ä‡πà‡∏ß‡∏á 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô + ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏ï‡∏±‡∏ß
```

üéä **‡∏•‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!**
